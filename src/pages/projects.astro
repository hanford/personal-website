---
import Layout from '../layouts/Layout.astro';
import Article from '../components/Article.astro';
import Card from '../components/Card.astro';

const now = new Date();

const pstFmt = new Intl.DateTimeFormat('en-US', {
  year: 'numeric', month: '2-digit', day: '2-digit',
  hour: '2-digit', minute: '2-digit', second: '2-digit',
  hour12: false,
  timeZone: 'America/Los_Angeles'
});

const regeneratedAtLocal = pstFmt.format(now);

const USER_NAME = "hanford";

interface GitHubRepo {
  id: number;
  owner: {
    login: string
  };
  name: string;
  description: string | null;
  stargazers_count: number;
  language: string | null;
  html_url: string;
  fork: boolean;
}

async function fetchGitHubRepos(username: string) {
  const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`, {
    headers: {
      'Authorization': `token ${import.meta.env.GITHUB_ACCESS_TOKEN}`,
      'Accept': 'application/vnd.github.v3+json',
      'User-Agent': 'personal-website'
    }
  });

  if (!response.ok) {
    throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
  }

  return response.json();
}

const data = await fetchGitHubRepos(USER_NAME);

const repos = data
  .filter(
    ({ fork, owner, stargazers_count: stars }: GitHubRepo) =>
      owner.login === USER_NAME && !fork && stars > 5
  )
  .sort((a: GitHubRepo, b: GitHubRepo) => b.stargazers_count - a.stargazers_count);
---

<Layout title="Projects | Jack Hanford">
  <a href={import.meta.env.BASE_URL} class="back-button">
    <span class="arrow">‚Üê</span>
     <span>Back</span>
  </a>

  <Card>
    <h1 class="title">Projects</h1>

    <p>
      Lately I've been obssessed with open source software which I keep
      on{" "}
      <a
        class="anchor"
        href="https://github.com/hanford"
        target="_blank"
      >
        GitHub
      </a>
      . I've been writing JavaScript professionally for around 4 years,
      and have become an expert with some of the latest and greatest
      frontend frameworks including{" "}
      <a
        class="anchor"
        href="https://www.npmjs.com/package/virtual-dom"
        target="_blank"
      >
        virtual-dom
      </a>
      ,{" "}
      <a class="anchor" href="https://angular.io" target="_blank">
        AngularJS
      </a>
      ,{" "}
      <a
        class="anchor"
        href="https://facebook.github.io/react"
        target="_blank"
      >
        ReactJS
      </a>{" "}
      and most recently{" "}
      <a
        class="anchor"
        href="https://github.com/zeit/next.js"
        target="_blank"
      >
        Next.js
      </a>
      .
    </p>

    {repos.map((repo: GitHubRepo) => (
      <Article
        path={repo.html_url}
        name={repo.name}
        about={repo.description || 'No description available'}
        stars={repo.stargazers_count.toString()}
        language={repo.language || undefined}
        isExternal={true}
      />
    ))}

    <p><pre>Rendered {regeneratedAtLocal}</pre></p>
  </Card>

  <style>
    .container {
      width: 100%;
      display: flex;
      justify-content: center;
      position: relative;
      justify-content: center;
      flex-direction: column;
      font-size: 1.6rem;
    }
    
    .title {
      margin: 0 0 2rem 0;
      font-size: 2rem;
      line-height: 2rem;
      letter-spacing: 0.03em;
      font-weight: bold;
    }

    .back-button {
      text-decoration: none;
      color: black;
      font-weight: 600;
      padding: 1rem 2rem;
      border-radius: 0.4rem;
      margin: 1rem;
      margin-top: 1rem;
      display: inline-block;
      position: fixed;
      top: 1rem;
      z-index: 2;
      backdrop-filter: blur(20px);
      background-color: transparent;
    }

    .arrow {
      display: inline-block;
      transition: transform 0.2s ease;
    }

    .back-button:hover .arrow {
      transform: translateX(-4px);
    }

    @media (max-width: 767px) {
      .back-button {
        margin: 0rem;
        margin-left: 1rem;
      }
    }

    .anchor {
      color: #d40052;
      font-weight: 600;
      text-decoration: underline;
    }

    p {
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    @media (prefers-color-scheme: dark) {
      .anchor {
        color: white;
      }
    }
  </style>
</Layout>
